# PowerShell Script for Malware Detection

# Define directories to scan
$DirectoriesToScan = @("C:\Users\Public\Documents", "C:\Windows\Temp")

# Define known malware signatures (simplified example)
$MalwareSignatures = @("malicious.exe", "ransomware.dll", "virus.bat")

# Define the path to the known safe hash list
$SafeHashListPath = "C:\SafeHashes.txt"

# Function to calculate the hash of a file
function Get-FileHash {
    param (
        [string]$FilePath
    )
    $hasher = [System.Security.Cryptography.HashAlgorithm]::Create("SHA256")
    $stream = [System.IO.File]::OpenRead($FilePath)
    $hash = $hasher.ComputeHash($stream)
    $stream.Close()
    return -join ($hash | ForEach-Object { "{0:x2}" -f $_ })
}

# Load the known safe hashes
$SafeHashes = Get-Content -Path $SafeHashListPath

# Function to scan directories for malware
function Scan-Directories {
    param (
        [array]$Dirs,
        [array]$Signatures
    )
    foreach ($dir in $Dirs) {
        if (Test-Path -Path $dir) {
            $files = Get-ChildItem -Path $dir -Recurse -File
            foreach ($file in $files) {
                $fileName = $file.Name
                $filePath = $file.FullName

                # Check for known malware signatures
                if ($Signatures -contains $fileName) {
                    Write-Host "Potential malware detected: $fileName in $filePath" -ForegroundColor Red
                }

                # Check file integrity by comparing hashes
                $fileHash = Get-FileHash -FilePath $filePath
                if ($SafeHashes -notcontains $fileHash) {
                    Write-Host "File integrity check failed: $filePath (Hash: $fileHash)" -ForegroundColor Yellow
                }
            }
        } else {
            Write-Host "Directory does not exist: $dir" -ForegroundColor Gray
        }
    }
}

# Run the malware scan
Write-Host "Starting malware scan..." -ForegroundColor Green
Scan-Directories -Dirs $DirectoriesToScan -Signatures $MalwareSignatures
Write-Host "Malware scan completed." -ForegroundColor Green
